{{- $target := .Target -}}
{{- $effectiveness := .Effectiveness -}}
{{- $grade := .Grade -}}
{{- $bypasses := .BypassCount -}}
{
  "blocks": [
    {
      "type": "header",
      "text": {
        "type": "plain_text",
        "text": "WAF Security Assessment Report"
      }
    },
    {
      "type": "section",
      "fields": [
        {
          "type": "mrkdwn",
          "text": "*Target:*\n{{ $target }}"
        },
        {
          "type": "mrkdwn",
          "text": "*Grade:*\n{{ $grade }}"
        },
        {
          "type": "mrkdwn",
          "text": "*Effectiveness:*\n{{ $effectiveness }}%"
        },
        {
          "type": "mrkdwn",
          "text": "*Duration:*\n{{ .Duration }}"
        }
      ]
    },
    {
      "type": "section",
      "fields": [
        {
          "type": "mrkdwn",
          "text": "*Total Tests:* {{ .TotalTests }}"
        },
        {
          "type": "mrkdwn",
          "text": "*Blocked:* {{ .Blocked }}"
        },
        {
          "type": "mrkdwn",
          "text": "*Bypassed:* {{ $bypasses }}"
        },
        {
          "type": "mrkdwn",
          "text": "*Errors:* {{ .Errors }}"
        }
      ]
    },
    {
      "type": "divider"
    }
    {{- if .Bypasses -}}
    ,{
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": ":warning: *{{ len .Bypasses }} Bypass(es) Detected*"
      }
    }
    {{- range $idx, $bypass := .Bypasses -}}
    ,{
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "{{ severityIcon $bypass.Test.Severity }} *{{ $bypass.Test.Name }}*\nCategory: {{ $bypass.Test.Category }} | Severity: {{ upper $bypass.Test.Severity }}\nStatus: {{ $bypass.Result.StatusCode }} | Latency: {{ $bypass.Result.LatencyMs }}ms"
      }
    }
    {{- end -}}
    {{- else -}}
    ,{
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": ":white_check_mark: All attack vectors blocked. No bypasses detected."
      }
    }
    {{- end }}
    ,{
      "type": "context",
      "elements": [
        {
          "type": "mrkdwn",
          "text": "Generated by WAFtester | {{ .Timestamp }}"
        }
      ]
    }
  ]
}